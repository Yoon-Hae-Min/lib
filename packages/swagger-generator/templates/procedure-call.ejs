<%
// ============================================================================
// 데이터 준비
// ============================================================================
const { utils, route, config, procedureHelpers,commonHelpers } = it;
const { preprocessed } = route;
const { path, method, payload } = route.request;
const { type, errorType } = route.response;
const { _ } = utils;

// 라우트 문서
const routeDocs = includeFile("@base/route-docs", { config, route, utils });

// Helper 함수를 통해 모든 값 계산
const requestConfigParam = procedureHelpers.buildRequestConfigParam(route, config);
const wrapperArgs = procedureHelpers.buildWrapperArgs(route, config, utils, requestConfigParam);
const queryKeyProps = procedureHelpers.buildQueryKeyProps(route, utils);
const contentVars = procedureHelpers.buildContentTypeVariables(route, config);
const returnType = procedureHelpers.buildReturnType(route, config);
%>

/**
<%~ routeDocs.description %>

*<% /* Here you can add some other JSDoc tags */ %>

<%~ routeDocs.lines %>

*/

<% if(commonHelpers.isGetMethod(method)){%>

<%~ route.routeName.usage %>Key = (<%~ queryKeyProps %>) => [<%- ~commonHelpers.buildQueryKey(path) %>,<% if (contentVars.queryTmpl) { %><%~ contentVars.queryTmpl %>,<% } %>]

<% } else { %>

<% } %>
<%~ route.routeName.usage %> = async (<%~ wrapperArgs %>)<%~ config.toJS ? `: ${returnType}` : "" %> => {
<% if (config.applyZodSchemaInAPI && payload?.type && commonHelpers.getSchemaName(payload.type)) { %>
  <%= commonHelpers.getSchemaName(payload.type) %>.parse(data);
<% } %>
  const response = await <%~ config.singleHttpClient ? 'this.http.request' : 'this.request' %><<%~ type %>, <%~ errorType %>>({
    path: `<%~ path %>`,
    method: '<%~ _.upperCase(method) %>',
    <%~ contentVars.queryTmpl ? `query: ${contentVars.queryTmpl},` : '' %>
    <%~ contentVars.bodyTmpl ? `body: ${contentVars.bodyTmpl},` : '' %>
    <%~ contentVars.securityTmpl ? `secure: ${contentVars.securityTmpl},` : '' %>
    <%~ contentVars.bodyContentKindTmpl ? `type: ${contentVars.bodyContentKindTmpl},` : '' %>
    <%~ contentVars.responseFormatTmpl ? `format: ${contentVars.responseFormatTmpl},` : '' %>
    ...<%~ requestConfigParam.name %>,
  })

<% if (config.applyZodSchemaInAPI && commonHelpers.getSchemaName(type)) { %>
  <%= commonHelpers.getSchemaName(type) %>.parse(response.data);
<% } %>

  return response;
};